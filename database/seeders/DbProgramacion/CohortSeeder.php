<?php

namespace Database\Seeders\DbProgramacion;

use Illuminate\Database\Seeder;
use App\Models\DbProgramacion\Cohort;
use App\Models\DbProgramacion\Program;
use App\Models\DbProgramacion\Town;
use Carbon\Carbon;

class CohortSeeder extends Seeder
{
    public function run(): void
    {
        $cohortsData = [
            // [ficha, codigo_programa, fecha_inicio, fecha_terminacion, aprendices, municipio]
            ['2876979', '226701', '2024-01-22', '2026-04-21', 30, 'FONSECA'],
            ['2930434', '635503', '2024-04-15', '2025-07-14', 30, 'FONSECA'],
            ['3141270', '836137', '2025-02-10', '2026-05-10', 30, 'FONSECA'],
            ['2876918', '836137', '2024-01-22', '2025-04-29', 25, 'BARRANCAS'],
            ['2876913', '135303', '2024-01-22', '2025-04-29', 30, 'URIBIA'],
            ['2876967', '124101', '2024-01-22', '2026-04-21', 30, 'FONSECA'],
            ['2876983', '621201', '2024-01-22', '2026-01-21', 30, 'FONSECA'],
            ['2876927', '633100', '2024-01-22', '2025-04-21', 20, 'RIOHACHA'],
            ['2876849', '733410', '2024-01-22', '2025-01-21', 8, 'MAICAO'],
            ['2876893', '233101', '2024-01-22', '2025-04-21', 30, 'SAN JUAN'],
            ['2876874', '180201', '2024-01-22', '2025-01-21', 23, 'LA JAGUA DEL PILAR'],
            ['2876898', '137136', '2024-01-22', '2025-04-21', 30, 'ALBANIA'],
            ['2932606', '722125', '2024-02-28', '2025-05-01', 33, 'RIOHACHA'],
            ['3141207', '733293', '2025-02-10', '2026-05-10', 30, 'FONSECA'],
            ['2930460', '621201', '2024-04-15', '2026-04-14', 30, 'FONSECA'],
            ['2930432', '123101', '2024-04-15', '2026-07-14', 30, 'FONSECA'],
            ['2963943', '833100', '2024-11-08', '2025-09-14', 24, 'BARRANCAS'],
            ['2974894', '733193', '2024-04-23', '2025-07-22', 25, 'MAICAO'],
            ['2972702', '722143', '2024-04-19', '2026-04-18', 20, 'FONSECA'],
            ['2977238', '522309', '2024-05-14', '2026-08-13', 47, 'FONSECA'],
            ['2977285', '723179', '2024-05-14', '2026-08-13', 42, 'FONSECA'],
            ['2998177', '228118', '2024-07-08', '2026-10-07', 17, 'FONSECA'],
            ['2876852', '222301', '2024-01-22', '2025-01-21', 17, 'RIOHACHA'],
            ['2876875', '134400', '2024-01-22', '2025-04-29', 30, 'DISTRACCIÓN'],
            ['2876847', '837305', '2024-01-22', '2025-04-21', 17, 'FONSECA'],
            ['2876934', '135303', '2024-01-22', '2025-04-29', 28, 'MANAURE'],
            ['2930468', '228118', '2024-04-15', '2026-04-14', 17, 'FONSECA'],
            ['2973114', '233108', '2024-04-19', '2025-07-18', 30, 'SAN JUAN DEL CESAR'],
            ['2977778', '121523', '2024-05-14', '2026-08-13', 37, 'FONSECA'],
            ['2998174', '123101', '2024-07-08', '2026-10-07', 30, 'FONSECA'],
            ['2997931', '226701', '2024-07-08', '2026-10-07', 30, 'FONSECA'],
            ['2997972', '226701', '2024-07-08', '2026-10-07', 30, 'FONSECA'],
            ['2997965', '921318', '2024-07-08', '2026-07-07', 30, 'FONSECA'],
            ['2998167', '228101', '2024-07-08', '2026-07-07', 30, 'FONSECA'],
            ['2998142', '832202', '2024-07-08', '2025-10-07', 30, 'FONSECA'],
            ['2998122', '137136', '2024-07-08', '2025-10-07', 30, 'ALBANIA'],
            ['2998115', '222301', '2024-07-08', '2025-10-07', 30, 'HATONUEVO'],
            ['2998060', '921219', '2024-07-08', '2025-07-07', 19, 'RIOHACHA'],
            ['2998007', '633100', '2024-07-08', '2024-10-07', 30, 'URUMITA'],
            ['2997995', '836138', '2024-07-08', '2025-10-07', 30, 'RIOHACHA'],
            ['2997964', '935100', '2024-07-08', '2025-04-07', 25, 'FONSECA'],
            ['2998027', '526600', '2024-07-08', '2025-04-07', 25, 'SAN JUAN DEL CESAR'],
            ['3019380', '842200', '2024-07-15', '2025-10-16', 20, 'FONSECA'],
            ['2876942', '228101', '2024-01-22', '2026-01-21', 30, 'FONSECA'],
            ['2930433', '226701', '2024-04-15', '2026-07-14', 20, 'FONSECA'],
            ['3118278', '733402', '2024-11-18', '2026-02-17', 37, 'RIOHACHA'],
            ['2997956', '723106', '2024-07-08', '2026-07-07', 25, 'FONSECA'],
            ['2998136', '664212', '2024-07-08', '2025-10-07', 30, 'VILLANUEVA'],
            ['3073894', '531200', '2024-09-05', '2025-11-01', 30, 'FONSECA'],
            ['3075526', '633100', '2024-09-07', '2025-12-06', 30, 'RIOHACHA'],
            ['3073893', '842200', '2024-09-24', '2025-12-23', 33, 'FONSECA'],
            ['3070374', '124100', '2024-09-16', '2026-12-15', 32, 'FONSECA'],
            ['3066562', '761513', '2024-10-15', '2025-04-14', 25, 'SAN JUAN'],
            ['3066551', '123101', '2024-10-15', '2027-01-22', 16, 'FONSECA'],
            ['3066575', '233105', '2024-10-15', '2026-01-22', 21, 'FONSECA'],
            ['3066580', '921700', '2024-10-15', '2027-01-22', 18, 'FONSECA'],
            ['3123172', '225313', '2024-10-28', '2026-02-06', 30, 'VILLANUEVA'],
            ['3070373', '224204', '2024-09-16', '2026-12-15', 41, 'RIOHACHA'],
            ['3141263', '832202', '2025-02-10', '2026-05-10', 30, 'FONSECA'],
            ['3141268', '635503', '2025-02-10', '2026-05-10', 30, 'FONSECA'],
            ['3141267', '733293', '2025-02-10', '2026-05-10', 30, 'RIOHACHA'],
            ['3141266', '134200', '2025-02-10', '2026-05-10', 30, 'ALBANIA'],
            ['3141264', '225313', '2025-02-10', '2026-05-10', 30, 'VILLANUEVA'],
            ['3141274', '842200', '2025-02-10', '2026-05-10', 30, 'FONSECA'],
            ['3141242', '134101', '2025-02-10', '2026-05-10', 30, 'URUMITA'],
            ['3141245', '133100', '2025-02-10', '2026-05-10', 30, 'FONSECA'],
            ['3141275', '134101', '2025-02-10', '2026-05-10', 30, 'FONSECA'],
            ['3141250', '733290', '2025-02-10', '2025-08-09', 25, 'FONSECA'],
            ['3141182', '761322', '2024-12-09', '2027-03-08', 46, 'FONSECA'],
            ['3134598', '124100', '2024-10-22', '2025-04-21', 27, 'MAICAO'],
            ['3123169', '761325', '2024-11-25', '2026-02-24', 30, 'VILLANUEVA'],
            ['3135646', '836137', '2024-05-14', '2026-08-13', 15, 'FONSECA'],
            ['2977144', '217320', '2025-02-10', '2026-10-14', 30, 'URIBIA'],
            ['3146599', '733193', '2025-03-31', '2027-06-30', 61, 'FONSECA'],
            ['3186660', '228118', '2025-03-31', '2027-06-30', 62, 'RIOHACHA'],
            ['3185801', '524703', '2025-03-31', '2027-06-30', 60, 'VIRTUAL'],
            ['3185969', '121523', '2025-03-31', '2026-06-30', 60, 'FONSECA'],
            ['3186271', '233104', '2025-04-07', '2026-07-06', 30, 'MAICAO'],
            ['3202168', '531200', '2025-04-29', '2027-04-28', 22, 'FONSECA'],
            ['3174668', '723107', '2025-04-21', '2026-07-20', 40, 'MAICAO'],
            ['3211468', '733401', '2024-04-15', '2026-04-14', 25, 'FONSECA'],
            ['2930465', '723107', '2024-04-15', '2025-07-14', 30, 'FONSECA'],
            ['2930497', '861100', '2024-05-14', '2025-08-13', 35, 'FONSECA'],
            ['2977823', '733402', '2025-03-31', '2027-06-30', 55, 'FONSECA'],
            ['3186102', '723179', '2025-04-29', '2027-04-28', 22, 'FONSECA'],
            ['3174672', '228101', '2025-04-10', '2025-12-04', 21, 'MANAURE'],
            ['3205003', '761512', '2025-04-29', '2027-05-28', 27, 'FONSECA'],
            ['3174404', '228118', '2025-04-29', '2027-05-28', 30, 'FONSECA'],
            ['3174412', '722148', '2025-04-29', '2027-04-28', 30, 'FONSECA'],
            ['3174634', '621201', '2025-04-29', '2027-05-28', 26, 'FONSECA'],
            ['3174444', '123101', '2025-04-29', '2026-06-28', 30, 'HATONUEVO'],
            ['3174460', '134101', '2025-04-29', '2026-07-28', 30, 'ALBANIA'],
            ['3174610', '222301', '2025-04-29', '2026-06-28', 28, 'SAN JUAN'],
            ['3174709', '836137', '2025-04-29', '2027-05-28', 25, 'FONSECA'],
            ['3174456', '921700', '2025-04-29', '2026-06-28', 30, 'FONSECA'],
            ['3174563', '635503', '2025-04-29', '2027-04-28', 30, 'FONSECA'],
            ['317463400', '621201', '2025-05-14', '2026-01-13', 25, 'SAN JUAN DEL CESAR'],
            ['3234158', '526600', '2025-05-19', '2025-07-18', 32, 'SAN JUAN'],
            ['3239123', '233108', '2025-05-22', '2026-07-21', 37, 'SAN JUAN'],
            ['3240964', '531200', '2025-05-26', '2026-07-25', 32, 'SAN JUAN'],
            ['3242773', '134102', '2025-06-09', '2026-08-08', 30, 'VILLANUEVA'],
            ['3252473', '135303', '2025-06-05', '2026-08-04', 32, 'MAICO'],
            ['3252741', '733193', '2025-06-25', '2026-08-24', 25, 'SAN JUAN'],
            ['3267899', '134102', '2025-07-03', '2026-07-02', 30, 'LA JAGUA DEL PILAR'],
            ['3272136', '733190', '2025-07-03', '2026-09-02', 30, 'DIBULLA'],
            ['3272014', '732208', '2025-07-25', '2027-07-24', 21, 'FONSECA'],
            ['3234484', '222203', '2025-07-25', '2026-10-24', 30, 'FONSECA'],
            ['3233363', '936113', '2025-07-25', '2027-07-24', 25, 'FONSECA'],
            ['3290547', '723106', '2025-07-25', '2027-10-24', 30, 'FONSECA'],
            ['3290911', '226701', '2025-07-25', '2027-10-24', 30, 'FONSECA'],
            ['3232951', '123101', '2025-07-26', '2026-03-25', 33, 'RIOHACHA'],
            ['3234511', '621201', '2025-08-06', '2026-10-05', 30, 'SAN JUAN'],
            ['3290577', '123101', '2025-07-25', '2026-09-24', 43, 'LA JAGUA'],
            ['3293602', '526600', '2025-08-19', '2026-10-18', 32, 'MANAURE'],
            ['3300663', '134102', '2025-08-19', '2026-11-19', 30, 'RIOHACHA'],
            ['3292308', '222239', '2024-04-15', '2025-07-14', 24, 'FONSECA'],
            ['3311767', '733410', '2024-04-15', '2025-07-14', 29, 'FONSECA'],
            ['3306482', '134101', '2024-10-15', '2026-01-22', 30, 'FONSECA'],
            ['2930495', '225313', '2024-10-15', '2025-10-14', 19, 'BARRANCAS'],
            ['2930483', '633400', '2024-09-16', '2025-12-15', 33, 'RIOHACHA'],
            ['3066574', '635503', '2024-10-15', '2026-10-14', 30, 'FONSECA'],
            ['3066559', '122814', '2024-10-15', '2026-10-14', 20, 'FONSECA'],
            ['3069992', '632201', '2024-10-15', '2026-10-14', 16, 'FONSECA'],
            ['3066553', '621201', '2025-05-14', '2026-07-13', 32, 'URIBIA'],
            ['3066560', '722143', '2025-02-10', '2026-05-09', 37, 'RIOHACHA'],
            ['3066542', '723107', '2025-06-09', '2026-08-08', 30, 'VILLANUEVA'],
            ['3229989', '733193', '2025-07-09', '2026-09-07', 32, 'SAN JUAN'],
            ['3147221', '722125', '2025-07-30', '2026-09-29', 30, 'BARRANCAS'],
            ['3253996', '134101', '2024-09-11', '2026-12-10', 38, 'RIOHACHA'],
            ['3278159', '664212', '2025-08-15', '2027-08-14', 25, 'FONSECA'],
            ['3295116', '134200', '2025-09-04', '2026-11-03', 41, 'HATONUEVO'],
            ['1000', '121524', '2025-08-16', '2025-11-30', 17, 'URIBIA'],
            ['3308127', '845302', '2025-07-25', '2027-10-24', 35, 'FONSECA'],
            ['3324930', '134200', '2025-09-15', '2026-11-14', 54, 'SAN JUAN'],
            ['3310834', '733259', '2025-09-18', '2026-03-17', 30, 'SAN JUAN'],
            ['3312002', '226701', '2025-09-26', '2026-05-25', 25, 'FONSECA'],
            ['3334739', '134102', '2024-04-15', '2025-04-14', 26, 'FONSECA'],
            ['3339240', '761513', '2024-04-15', '2025-07-14', 22, 'VILLANUEVA'],
            ['3346617', '935105', '2024-04-18', '2026-04-17', 25, 'FONSECA'],
            ['2930485', '632105', '2024-07-08', '2025-10-07', 25, 'VILLANUEVA'],
            ['2930486', '836138', '2024-07-08', '2025-07-07', 30, 'DISTRACCION'],
            ['2971668', '723107', '2024-07-08', '2024-10-07', 30, 'RIOHACHA'],
            ['2998143', '733193', '2024-10-28', '2026-02-06', 31, 'VILLANUEVA'],
            ['2998017', '632305', '2024-07-08', '2026-07-07', 30, 'FONSECA'],
            ['2998029', '135303', '2024-07-08', '2026-07-07', 30, 'FONSECA'],
            ['3123260', '233108', '2024-09-16', '2025-12-15', 39, 'RIOHACHA'],
            ['2997942', '621201', '2024-10-22', '2025-04-21', 25, 'MAICAO'],
            ['2998150', '621201', '2025-04-29', '2027-04-28', 18, 'FONSECA'],
            ['3069991', '233109', '2025-04-29', '2026-06-28', 30, 'RIOHACHA'],
            ['3123160', '761325', '2025-06-03', '2026-08-02', 26, 'ALBANIA'],
            ['3174600', '524113', '2025-07-14', '2026-09-13', 32, 'DISTRACCION'],
            ['3174575', '133303', '2025-07-25', '2027-10-24', 30, 'FONSECA'],
            ['3247131', '134102', '2024-07-08', '2025-10-07', 30, 'FONSECA'],
            ['3283012', '733193', '2025-05-29', '2026-01-28', 8, 'MANAURE'],
            ['3232972', '226701', '2025-04-29', '2026-06-28', 30, 'FONSECA'],
            ['2998146', '845300', '2025-08-16', '2026-11-30', 20, 'MANAURE'],
            ['3246387', '733410', '2024-10-15', '2026-01-22', 17, 'RIOHACHA'],
            ['3174539', '733401', '2024-10-15', '2026-01-22', 22, 'VILLANUEVA'],
            ['3310836', '733410', '2024-10-15', '2026-01-22', 20, 'HATONUEVO'],
            ['3066540', '233105', '2024-10-15', '2027-01-22', 22, 'FONSECA'],
            ['3066577', '233105', '2024-10-28', '2026-11-27', 20, 'FONSECA'],
            ['3066557', '233108', '2024-11-18', '2027-02-17', 40, 'VIRTUAL'],
            ['3066552', '228118', '2025-06-09', '2026-08-08', 32, 'VILLANUEVA'],
            ['3123157', '845302', '2025-07-25', '2026-10-24', 30, 'BARRANCAS'],
            ['3118375', '121523', '2025-08-15', '2026-10-14', 30, 'FONSECA'],
            ['3254009', '664212', '2025-08-16', '2025-11-30', 25, 'URIBIA'],
            ['3233360', '134200', '2025-09-15', '2026-11-14', 33, 'HATONUEVO'],
            ['3308137', '845300', '2024-10-15', '2027-01-22', 30, 'FONSECA'],
            ['3310823', '733259', '2025-04-29', '2027-05-28', 30, 'FONSECA'],
            ['3334812', '222301', '2025-04-29', '2027-04-28', 30, 'FONSECA'],
            ['3066539', '226701', '2025-04-29', '2026-06-28', 28, 'FONSECA'],
            ['3174308', '226701', '2025-04-29', '2027-05-28', 30, 'FONSECA'],
            ['3174638', '621201', '2025-04-29', '2026-06-28', 28, 'RIOHACHA'],
            ['3174712', '836137', '2025-05-29', '2026-01-28', 17, 'MAICAO'],
            ['3223907', '226701', '2025-07-03', '2026-09-09', 30, 'DIBULLA'],
            ['3174524', '231100', '2025-07-25', '2026-10-24', 25, 'FONSECA'],
            ['3245115', '761330', '2025-07-25', '2026-07-24', 19, 'URUMITA'],
            ['3272166', '134102', '2025-07-25', '2026-10-24', 30, 'RIOHACHA'],
            ['3234475', '833100', '2025-07-25', '2026-10-24', 18, 'FONSECA'],
            ['3233319', '733171', '2025-07-25', '2027-10-24', 30, 'FONSECA'],
            ['3233368', '633200', '2025-08-01', '2027-07-31', 35, 'FONSECA'],
            ['3234481', '232100', '2025-08-19', '2026-10-18', 30, 'FONSECA'],
            ['3233006', '226701', '2025-08-19', '2026-10-18', 30, 'FONSECA'],
            ['3296585', '621201', '2025-07-25', '2027-07-24', 30, 'FONSECA'],
            ['3308026', '134102', '2025-06-03', '2027-09-02', 54, 'FONSECA'],
            ['3308040', '134102', '2026-06-13', '2026-08-12', 30, 'MAICAO'],
            ['3312006', '621201', '2025-08-25', '2026-02-24', 35, 'DISTRACCION'],
            ['3236012', '134102', '2025-09-08', '2026-10-07', 36, 'FONSECA'],
            ['3260646', '633100', '2025-09-05', '2026-11-04', 36, 'SAN JUAN'],
        ];

        // Obtener todos los municipios disponibles
        $towns = Town::all();
        $townIds = $towns->pluck('id', 'name')->toArray();

        foreach ($cohortsData as $cohortData) {
            $this->crearCohorte($cohortData, $townIds, $towns);
        }
    }

    private function crearCohorte($cohortData, $townIds, $towns)
    {
        [$ficha, $codigoPrograma, $fechaInicio, $fechaTerminacion, $aprendices, $municipio] = $cohortData;

        // Buscar programa por código
        $program = Program::where('program_code', $codigoPrograma)->first();
        if (!$program) {
            return;
        }

        // Buscar municipio por nombre, si no existe usar random
        $townId = $townIds[$municipio] ?? $towns->random()->id;

        Cohort::create([
            'number_cohort' => $ficha,
            'id_program' => $program->id,
            'id_time' => rand(1, 2), // 1=Diurno, 2=Nocturno
            'id_town' => $townId,
            'start_date' => $fechaInicio,
            'end_date' => $fechaTerminacion,
            'enrolled_quantity' => $aprendices,
            'created_at' => now(),
            'updated_at' => now()
        ]);
    }
}
